<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.SubscriptionDAO">
  	<!-- DB의 컬럼명과 VO의 변수명 맵핑 -->
  	<resultMap type="subscriptionVO" id="subscriptionMap">
  		<result column="payment_no" property="paymentNo" />
  		<result column="member_id" property="memberId" />
  		<result column="pass_no" property="passNo" />
  		<result column="start_date" property="startDate" />
  		<result column="end_date" property="endDate" />
  		<result column="remain_classes" property="remainClasses" />
  	</resultMap>
  	
  	<sql id="selectPayment">
  		select no, member_id, pass_no, amount, pay_method, to_char(pay_date, 'yyyy-mm-dd') pay_date
  		  from payment
  	</sql>
 
  	<!-- 이용권 내역 삽입 -->
  	<insert id="insert" parameterType="subscriptionVO">
  		INSERT INTO SUBSCRIPTION (NO, PAYMENT_NO, MEMBER_ID , PASS_NO, START_DATE, END_DATE, REMAIN_CLASSES)
		SELECT SEQ_SUBSCRIPTION_NO.nextval
			 , SEQ_PAYMENT_NO.currval
			 , #{memberId}
    		 , #{passNo}
    		 , SYSDATE
    		 , ADD_MONTHS(to_date(to_char(SYSDATE, 'yyyymmdd') || '235959', 'yyyymmddhh24miss'), duration) 
   			 , total_classes 
  		  FROM pass 
 		 WHERE NO = #{passNo};
  	</insert>
</mapper>